return(async()=>{var c=class{constructor(e,t,r){this.debug=e,this.prefix=t,this.isTestMode=r}log(e,t){this.debug&&console.log(`${this.prefix} ${e}`,t??"")}error(e,t){console.error(`${this.prefix} ${e}`,t??"")}warn(e,t){console.warn(`${this.prefix} ${e}`,t??"")}testHeader(e,t){if(!this.isTestMode)return;const r="=".repeat(80);console.debug(r),console.debug(e),console.debug(r),t!==void 0&&(console.debug(t),console.debug(r))}testResult(e){if(!this.isTestMode)return;const t="=".repeat(80);console.debug(t),console.debug("RESULT:"),console.debug(t),console.debug(typeof e=="string"?e:JSON.stringify(e,null,2)),console.debug(t)}testInfo(e,t){this.isTestMode&&(t!==void 0?console.debug(e,t):console.debug(e))}};function u(e,t,r){const o=r?`[${t} Test]`:`[AEP ${t}]`;return new c(e,o,r)}var s=5*1024*1024;function l(e,t,r){const o=new AbortController,n=setTimeout(()=>o.abort(),r);return fetch(e,{...t,signal:o.signal}).finally(()=>{clearTimeout(n)})}function f(e){const t=e.headers.get("content-length");if(t&&parseInt(t,10)>s)throw new Error(`Response too large: ${t} bytes (max: ${s})`)}function g(e){return e instanceof Error&&e.name==="AbortError"}function d(e){return e instanceof TypeError&&e.message.includes("fetch")}var E={EVENT_ENDPOINT:"/api/event.json?meta=true"};async function h(e,t){const o=`${window.location.origin}${E.EVENT_ENDPOINT}`;t.log("Fetching event data from",o);const n=await l(o,{method:"GET",headers:{Accept:"application/json"}},e.timeout);if(!n.ok)throw t.error(`API error: ${n.status} ${n.statusText}`),new Error(`API returned ${n.status}`);f(n);const a=await n.json();return t.log("Event data received",a),a}async function i(e=!1){const t={timeout:1e4,debug:e},r=u(t.debug,"Event Data",e);try{r.testHeader("EVENT DATA EXTRACTOR - TEST MODE");const o=await h(t,r);return r.testResult(o),e||r.log("Returning event data",o),o}catch(o){return g(o)?(r.error(`Request timeout after ${t.timeout}ms`),null):d(o)?(r.error("Network error:",o),null):(r.error("Unexpected error fetching event data:",o),null)}}return await i(!1)})();
